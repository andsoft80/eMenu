<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="http://cdn.webix.com/edge/webix.css" type="text/css"> 
        <script src="http://cdn.webix.com/edge/webix.js" type="text/javascript"></script>  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="webix_dte.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://cdn.materialdesignicons.com/2.7.94/css/materialdesignicons.css" type="text/css" charset="utf-8">

        <script type="text/javascript" charset="utf-8">



            var tableName = 'users';


            var colinfo = [
                {"idx": 0, "name": "#"},
                {"idx": 1, "name": "Эл.почта"},
                {"idx": 2, "name": "Имя"},
                {"idx": 3, "name": "Пароль"}
            ];

            // var colinfo = null;
            var grida = buildCRUDTable(tableName, colinfo);
            var gridaMain = null;
            webix.ready(function () {
                var refresh = function () {
                    ///////////////////////////////////////refresh
                    $$(tableName).clearAll();
                    $.ajax({
                        type: "post",
                        async: false,
                        url: "/table/" + tableName + "/action/get",
                        success: function (data) {


                            $$(tableName).parse(JSON.parse(data));

                        }
                    });
                    ///////////////////////////////////////
                };

                gridaMain = new webix.ui({
                    container: 'box',
                    rows: grida
                });
                $$(tableName).select('1', true);
                $$(tableName + "_create").attachEvent('onItemClick', function () {
                    if (!$$(tableName).getItem('*')) {
                        $$(tableName).add({id: '*'}, 0);
                    } else {
                        alert('У вас уже есть строка которую вы создаете! Сохраните или удалите ее...');
                    }
                });
                $$(tableName + "_delete").attachEvent('onItemClick', function () {


                    webix.confirm({
                        title: "Удаление строки",
                        ok: "Да", cancel: "Отмена",

                        text: "Подтверждаете удаление?",
                        callback: function (result) {
                            var selId = $$(tableName).getSelectedId(true)[0];

                            if (result) {


                                if (selId == '*') {

                                    $$(tableName).remove(selId);
                                } else {

                                    var parcel = {};
                                    parcel.id = selId.id;

                                    $.ajax({
                                        type: "post",
                                        async: false,
                                        url: "/table/" + tableName + "/action/delete",
                                        data: parcel,
                                        success: function (data) {
                                            var parcel = JSON.parse(data);
                                            if (parcel.serverStatus === 2) {

                                                refresh();


                                            } else {
                                                alert(data);
                                            }
                                        }
                                    });
                                }

                            }
                        }
                    });




                });

                $$(tableName + "_save").attachEvent('onItemClick', function () {
                    var selId = $$(tableName).getSelectedId(true)[0];
                    var item = $$(tableName).getItem(selId);
                    if (selId != '*') {



                        $.ajax({
                            type: "post",
                            async: false,
                            url: "/table/" + tableName + "/action/put",
                            data: item,
                            success: function (data) {
                                var parcel = JSON.parse(data);
                                if (parcel.serverStatus === 2) {

//                                    refresh();


                                } else {
                                    alert(data);
                                }
                            }
                        });
                    } else {

                        delete item['id'];
                        $.ajax({
                            type: "post",
                            async: false,
                            url: "/table/" + tableName + "/action/post",
                            data: item,
                            success: function (data) {
                                var parcel = JSON.parse(data);
                                if (parcel.serverStatus === 2) {

                                    refresh();


                                } else {
                                    alert(data);
                                }
                            }
                        });

                    }

                });


            });


        </script>
    </head>
    <body>
        <div id="box" style='width: 100%; height: 500px'>
        </div>
    </body>
</html>
